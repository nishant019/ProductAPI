<!DOCTYPE html>
<html>

<head>
    <title>Users List</title>
</head>
<link rel="stylesheet" href="/pagination.css">

<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<style>

</style>

<body>
    <div id="menu"></div>
    <table id="userTable" border="1">
        <thead>
            <tr>
                <th>SN</th>
                <th>Product ID</th>
                <th>Product Name</th>
                <th>Address</th>
                <th>Address1</th>
                <th>Address2</th>
                <th>Image</th>
                <th>Product Title</th>
                <th>Product Description</th>
                <th>Created By</th>
                <th>Updated Date</th>
                <th>Updated Date</th>
                <th>Updated By</th>

            </tr>


        </thead>

        <tbody>
            <!-- Data will be inserted here dynamically -->
        </tbody>
    </table>
    <table style="border:1px">
        <td>Total Users: <a id="userCount"></a></td>&nbsp;
        <td>Total Pages: <a id="pageCount"></a></td>&nbsp;

        <td>Page Number: <a id="pageNumber"></a></td>&nbsp;
        <td>
            <div id="loadingIndicator" style="display: none;">Loading...</div>
        </td>

    </table>
    <div id="page">
        <button id="previousPage">
            < </button>
                <div class="pagination" id="pagination-container">
                </div>

                <button id="nextPage">> </button>
    </div>
    <p id="profile"></p>
    <p id="error"></p>

</body>
<script type="text/javascript" src="/pagination.js">  </script>
<script type="text/javascript" src="/loggedin.js">  </script>
<script type="text/javascript" src="/menu.js">  </script>
<script>
  let index = 1;
  function historyManagement() {
    historyStates.pop()
    if (historyStates.length > 0) {
      getProducts(historyStates[historyStates.length - 1].page)
      historyStates.pop()
    } else {
      history.back()
      getProducts(`1`)
      history.back()
    }
  }
  window.addEventListener("popstate", function () {
    historyManagement()
  });

  document.addEventListener('DOMContentLoaded', function () {
    let sta = []
    let hasPageBeenLoaded = localStorage.getItem('pageLoaded');
    if (!hasPageBeenLoaded) {
      localStorage.setItem('pageLoaded', 'true');
      window.addEventListener("unload", function () {
        getProducts('1');
      });
    } else {
      sta = JSON.parse(localStorage.getItem("state"))
      if (sta[sta.length - 1].page) {
        index = sta[sta.length - 1].page
      }
    }
    getProducts(index);

  })
  document.getElementById("previousPage").addEventListener("click", (e) => {
    if (currentPage > 1) {
      currentPage--; // Decrement the current page number
    }
    getProducts(currentPage)
  });

  document.getElementById("nextPage").addEventListener("click", (e) => {
    if (currentPage < maxPages) {
      currentPage++; // Increment the current page number
    }
    getProducts(currentPage)

  });
  document.getElementById("pagination-container").addEventListener("click", function (event) {
    if (event.target.tagName === "A") {
      event.preventDefault(); // Prevent the default link behavior
      const clickedPage = parseInt(event.target.textContent);
      // Set the active page
      currentPage = clickedPage;
      getProducts(currentPage);
    }
  });

</script>

</html>