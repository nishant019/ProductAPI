<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Product Types</title>
    <style>
        #productTypes {
            width: max-content;
            height: max-content;
        }

        .list-item {
            cursor: pointer;
            padding: 10px;
            margin: 5px;
            border: 1px solid #ccc;
            border-radius: 5px;
        }

        .sub-list {
            margin-left: 20px;
            display: none;
        }
        .sub-category-list-item{
            margin-left: 20px;
            border: 1px solid #ddd;
            border-radius: 3px;

        }

        .sub-list-item {
            padding: 5px;
            margin: 2px;
            border: 1px solid #ddd;
            border-radius: 3px;
        }

        .category-list {
            display: none;
        }
    </style>
</head>

<body>
    <div id="productTypes"></div>
    <div id="categoryList" class="category-list"></div>
</body>
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<script>
    async function createListItem(data, listDiv) {
        const subList = document.createElement('div');
        subList.className = 'sub-list';
        const listItem = document.createElement('div');
        const prodTypeContainer = document.createElement('div');
        prodTypeContainer.className = 'prod-type'
        listItem.className = 'list-item';
        prodTypeContainer.textContent = `${data.prodTypeName} ( ${data.totalProducts} )`;
        listItem.appendChild(prodTypeContainer)
        fetchCategory(data.prodTypeId, subList);
        prodTypeContainer.addEventListener('click', () => {

            listItem.appendChild(subList);
            if (subList.style.display === 'block') {
                subList.style.display = 'none';
            } else {
                subList.style.display = 'block';
            }

        });

        listDiv.appendChild(listItem);

        return listItem;
    }

    async function fetchCategory(prodTypeId, subList) {
        try {
            // Replace this URL with the actual URL for fetching sub-categories
            const response = await axios.get(`http://localhost:3000/listCategory/:id?prodTypeId=${prodTypeId}`);
            const categories = response.data.data;

            subList.innerHTML = '';

            categories.forEach(category => {
                const subListItem = createCategoryItem(category);
                subList.appendChild(subListItem);
            });
        } catch (error) {
            console.error(error);
        }
    }

    function createCategoryItem(category) {
        const subListItem = document.createElement('div');
        subListItem.className = 'sub-list-item';

        const subCategoryListItem = document.createElement('div');
        subCategoryListItem.className = 'sub-category-list-item';

        subListItem.textContent = `${category.categoryName}  ( ${category.totalProducts} )`;

        const catgeoryList = document.createElement('div')
        catgeoryList.className = 'category-list'
        
        subListItem.appendChild(catgeoryList)

        fetchSubCategory(category.categoryId, subCategoryListItem);

        subListItem.addEventListener('click', async () => {

            if (subCategoryListItem.style.display === 'block') {
                subCategoryListItem.style.display = 'none';
            } else {
                subCategoryListItem.style.display = 'block';
            }

            catgeoryList.appendChild(subCategoryListItem);


        });


        return subListItem;
    }

    async function fetchSubCategory(categoryId, subList) {
        try {
            // Replace this URL with the actual URL for fetching sub-categories
            const response = await axios.get(`http://localhost:3000/listSubCategory/:id?categoryId=${categoryId}`);
            const subCategories = response.data.data;
            const subListItem = document.querySelector('.sub-list-item')
            // subList.innerHTML = '';

            subCategories.forEach(subCategory => {
                const subListCategoryItem = createSubListItem(subCategory);
                subList.appendChild(subListCategoryItem);
            });
        } catch (error) {
            console.error(error);
        }
    }

    function createSubListItem(subCategory) {
        const subListItem = document.createElement('div');
        subListItem.className = 'sub-category-list-item';
        subListItem.textContent = `${subCategory.subCategoryName}  ( ${subCategory.totalProducts} )`;
        return subListItem;
    }

    async function fetchProductType() {
        try {
            const response = await axios.get('http://localhost:3000/listProductType/:id');
            const productTypesContainer = document.getElementById('productTypes');
            const productTypes = response.data.data;

            productTypesContainer.innerHTML = '';

            productTypes.forEach(productType => {
                const listDiv = document.createElement('div');
                listDiv.className = 'list-div';

                createListItem(productType, listDiv);

                productTypesContainer.appendChild(listDiv);
            });
        } catch (error) {
            console.error(error);
        }
    }

    document.addEventListener('DOMContentLoaded', () => {
        fetchProductType();
    });

</script>

</html>