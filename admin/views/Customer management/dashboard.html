<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Product Types</title>
    <style>
        #productTypes{
            width :20%
        }
        body {
            margin: 20px;
        }

        .list-item {
            cursor: pointer;
            padding: 10px;
            margin-bottom: 5px;
            background-color: #f0f0f0;
            border-radius: 5px;
        }

        .category-item {
            cursor: pointer;
            margin-left: 20px;
            display: flex;
            flex-direction: column; /* Updated style */
            margin-bottom: 5px;
        }

        .category-name {
            margin-bottom: 5px;
            font-weight: bold;
            cursor: pointer;
        }

        .sub-category-list {
            cursor: pointer;
            margin-left: 20px; /* Adjusted margin */
            background-color: #f8f8f8;
            border-radius: 3px;
            display: none;
            padding: 5px;
        }

        .sub-category-list-item {
            cursor: pointer;
            margin-left: 20px; /* Adjusted margin */
            background-color: #f8f8f8;
            border-radius: 3px;
            padding: 5px;
        }
    </style>
</head>

<body>
    <div id="productTypes"></div>
</body>
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<script>
    async function createProductTypeItem(productType, container) {
        const productTypeItem = createListItem(productType);
        const categoryList = document.createElement('div');

        productTypeItem.addEventListener('click', async () => {
            toggleDisplay(categoryList);
            if (categoryList.style.display === 'block') {
                fetchAndDisplayCategories(productType.prodTypeId, categoryList);
            }
        });

        container.appendChild(productTypeItem);
        container.appendChild(categoryList);
    }

    function createListItem(data) {
        const listItem = document.createElement('div');
        listItem.className = 'list-item';
        listItem.textContent = `${data.prodTypeName} ( ${data.totalProducts} )`;
        return listItem;
    }

    async function fetchAndDisplayCategories(prodTypeId, categoryList) {
        try {
            const categories = await fetchData(`http://localhost:3000/listCategory/:id?prodTypeId=${prodTypeId}`);
            renderCategories(categories, categoryList);
        } catch (error) {
            console.error(error);
        }
    }

    function renderCategories(categories, categoryList) {
        categoryList.innerHTML = '';

        categories.forEach(category => {
            const categoryItem = createCategoryItem(category);
            categoryList.appendChild(categoryItem);
        });
    }

    async function fetchAndDisplaySubCategories(categoryId, subCategoryList) {
        try {
            const subCategories = await fetchData(`http://localhost:3000/listSubCategory/:id?categoryId=${categoryId}`);
            renderSubCategories(subCategories, subCategoryList);
        } catch (error) {
            console.error(error);
        }
    }

    function renderSubCategories(subCategories, subCategoryList) {
        subCategoryList.innerHTML = '';

        subCategories.forEach(subCategory => {
            const subCategoryItem = createSubCategoryItem(subCategory);
            subCategoryList.appendChild(subCategoryItem);
        });
    }

    function createCategoryItem(category) {
        const categoryItem = document.createElement('div');
        categoryItem.className = 'category-item';

        const categoryName = document.createElement('div');
        categoryName.className = 'category-name';
        categoryName.textContent = `${category.categoryName} ( ${category.totalProducts} )`;
        categoryItem.appendChild(categoryName);

        const subCategoryList = document.createElement('div');
        subCategoryList.className = 'sub-category-list'; // Updated class name
        categoryItem.appendChild(subCategoryList);

        categoryName.addEventListener('click', () => {
            toggleDisplay(subCategoryList);
            if (subCategoryList.style.display === 'block') {
                fetchAndDisplaySubCategories(category.categoryId, subCategoryList);
            }
        });

        return categoryItem;
    }

    function createSubCategoryItem(subCategory) {
        const subCategoryItem = document.createElement('div');
        subCategoryItem.className = 'sub-category-list-item';
        subCategoryItem.textContent = `${subCategory.subCategoryName}  ( ${subCategory.totalProducts} )`;
        return subCategoryItem;
    }

    async function fetchData(url) {
        const response = await axios.get(url);
        return response.data.data;
    }

    function toggleDisplay(element) {
        element.style.display = element.style.display === 'block' ? 'none' : 'block';
    }

    async function fetchProductTypes() {
        try {
            const productTypes = await fetchData('http://localhost:3000/listProductType/:id');
            const productTypesContainer = document.getElementById('productTypes');

            productTypesContainer.innerHTML = '';

            productTypes.forEach(productType => {
                const productTypeDiv = document.createElement('div');
                createProductTypeItem(productType, productTypeDiv);
                productTypesContainer.appendChild(productTypeDiv);
            });
        } catch (error) {
            console.error(error);
        }
    }

    document.addEventListener('DOMContentLoaded', fetchProductTypes);
</script>

</html>
