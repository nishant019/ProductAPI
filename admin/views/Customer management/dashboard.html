<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Product Types</title>
    <style>
        .list-item {
            cursor: pointer;
            padding: 10px;
            margin: 5px;
            border: 1px solid #ccc;
            border-radius: 5px;
        }

        .sub-list {
            margin-left: 20px;
            display: none;
        }

        .sub-list-item {
            padding: 5px;
            margin: 2px;
            border: 1px solid #ddd;
            border-radius: 3px;
        }

        .category-list {
            display: none;
        }
    </style>
</head>

<body>
    <div id="productTypes"></div>
    <div id="categoryList" class="category-list"></div>
</body>
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<script>
    // Function to create a list item
    function createListItem(data) {
        const listItem = document.createElement('div');
        listItem.className = 'list-item';
        listItem.textContent = `${data.prodTypeName} ( ${data.totalProducts} )`;
        listItem.addEventListener('click', () => toggleSubList(data.prodTypeId, listItem));
        return listItem;
    }

    // Function to toggle the display of sub-list
    async function toggleSubList(prodTypeId, listItem) {
        const subList = listItem.querySelector('.sub-list');

        // If sub-list doesn't exist, create it and append to the listItem
        if (!subList) {
            const newSubList = document.createElement('div');
            newSubList.className = 'sub-list';
            listItem.appendChild(newSubList);

            // Fetch and populate sub-list
            await fetchCategory(prodTypeId, newSubList);
        } else {
            // Toggle the display of existing sub-list
            subList.style.display = subList.style.display === 'none' ? 'block' : 'none';

            // If sub-list is being displayed for the first time, fetch and populate
            if (subList.style.display === 'block' && subList.childElementCount === 0) {
                await fetchCategory(prodTypeId, subList);
            }
        }

        // Toggle the display of the categoryList
        const categoryList = document.getElementById('categoryList');
        categoryList.style.display = 'block';
    }

    // Function to fetch category data and populate the sub-list
    async function fetchCategory(prodTypeId, subList) {
        try {
            // Replace this URL with the actual URL for fetching sub-categories
            const response = await axios.get(`http://localhost:3000/listCategory/:id?prodTypeId=${prodTypeId}`);
            const categories = response.data.data;

            // Clear existing content before appending new content
            subList.innerHTML = '';

            categories.forEach(category => {
                const subListItem = createCategoryItem(category);
                subList.appendChild(subListItem);
            });
        } catch (error) {
            console.error(error);
        }
    }

    // Function to create a sub-list item
    function createCategoryItem(category) {
        const subListItem = document.createElement('div');
        subListItem.className = 'sub-list-item';
        subListItem.textContent = `${category.categoryName}  ( ${category.totalProducts} )`;
        subListItem.addEventListener('click', () => fetchSubCategory(category.categoryId, subListItem));
        return subListItem;
    }

    // Function to fetch sub-category data and populate the sub-list
    async function fetchSubCategory(categoryId, subList) {
        try {
            // Replace this URL with the actual URL for fetching sub-categories
            const response = await axios.get(`http://localhost:3000/listSubCategory/:id?categoryId=${categoryId}`);
            const subCategories = response.data.data;

            // Clear existing content before appending new content
            subList.innerHTML = '';

            subCategories.forEach(subCategory => {
                const subListItem = createSubListItem(subCategory);
                subList.appendChild(subListItem);
            });
        } catch (error) {
            console.error(error);
        }
    }

    // Function to create a sub-list item
    function createSubListItem(subCategory) {
        const subListItem = document.createElement('div');
        subListItem.className = 'sub-list-item';
        subListItem.textContent = `${subCategory.subCategoryName}  ( ${subCategory.totalProducts} )`;
        return subListItem;
    }

    // Function to fetch product type data and populate the main list
    async function fetchProductType() {
        try {
            const response = await axios.get('http://localhost:3000/listProductType/:id');
            const productTypesContainer = document.getElementById('productTypes');
            const productTypes = response.data.data;

            // Clear existing content before appending new content
            productTypesContainer.innerHTML = '';

            productTypes.forEach(productType => {
                const listItem = createListItem(productType);
                productTypesContainer.appendChild(listItem);
            });
        } catch (error) {
            console.error(error);
        }
    }

    document.addEventListener('DOMContentLoaded', () => {
        fetchProductType();
    });
</script>

</html>
